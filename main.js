(()=>{"use strict";var t={baseURL:"https://nomoreparties.co/v1/wff-cohort-40",headers:{authorization:"a8747f66-522a-45b2-ab1a-dc8d903fb7d7","content-type":"application/json"}},e=function(e){return fetch("".concat(t.baseURL,"/cards/").concat(e,"/likes"),{method:"PUT",headers:t.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка ".concat(t.status))}))},n=function(e){return fetch("".concat(t.baseURL,"/cards/").concat(e,"/likes"),{method:"DELETE",headers:t.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка ".concat(t.status))}))},o=document.querySelector("#card-template").content;function r(t,r,c,a,i){var u=o.querySelector(".card").cloneNode(!0);u.querySelector(".card__title").textContent=t.name;var s=u.querySelector(".card__delete-button"),l=u.querySelector(".card__like-button"),d=u.querySelector(".card__like-count"),p=u.querySelector(".card__image"),f=t.likes.length;return t.likes.some((function(t){return t._id===r}))&&l.classList.add("card__like-button_is-active"),s.addEventListener("click",(function(){c(t._id,u)})),l.addEventListener("click",(function(){var o=l;(o.classList.contains("card__like-button_is-active")?n:e)(t._id).then((function(t){i(o),d.textContent=t.likes.length})).catch((function(t){console.error(t)}))})),p.addEventListener("click",(function(){a(u)})),d.textContent=f,Object.assign(p,{src:t.link,alt:t.name}),t.owner._id!==r&&(s.style.display="none"),u}function c(t){t.classList.toggle("card__like-button_is-active")}function a(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",u)}function i(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",u)}function u(t){"Escape"===t.key&&i(document.querySelector(".popup_is-opened"))}function s(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),o.textContent="",o.classList.remove(n.errorClass)}function l(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove(n.inactiveButtonClass),e.removeAttribute("disabled")):(e.classList.add(n.inactiveButtonClass),e.setAttribute("disabled",!0))}function d(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);n.forEach((function(n){s(t,n,e)})),l(n,o,e)}var p,f=document.querySelector.bind(document),m=document.querySelectorAll.bind(document),_=f(".places__list"),h=f(".profile__edit-button"),v=f(".profile__add-button"),y=m(".popup__close"),b=f(".profile__title"),S=f(".profile__description"),L=f(".profile__image"),k=document.querySelectorAll(".popup"),E=f(".popup_type_edit"),C=f(".popup_type_new-card"),q=f(".popup_type_image"),g=f(".popup_type_delete-card"),j=f(".popup_type_update-avatar"),x=g.querySelector(".popup__button"),A=document.querySelector(".popup_type_delete-card"),z=null,P=null,T=document.forms["edit-profile"],U=T.elements["profile-name"],B=T.elements.description,R=document.forms["new-place"],w=R.elements["place-name"],D=R.elements.link,O=document.forms["new-avatar"],N=O.elements.link,J={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},M=T.querySelector(J.submitButtonSelector),H=R.querySelector(J.submitButtonSelector),I=O.querySelector(J.submitButtonSelector);function V(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Что-то пошло не так";console.log("".concat(e," ").concat(t)),alert("".concat(e))}function F(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить";e.textContent=t?"Сохранение...":n}function G(t,e){z=t,P=e,a(A)}function K(t){var e=t.querySelector(".card__image"),n=t.querySelector(".card__title"),o=q.querySelector(".popup__image");q.querySelector(".popup__caption").textContent=n.textContent,Object.assign(o,{src:e.src,alt:e.alt}),a(q)}x.addEventListener("click",(function(){var e;(e=z,fetch("".concat(t.baseURL,"/cards/").concat(e),{method:"DELETE",headers:t.headers}).then((function(t){if(!t.ok)return Promise.reject("Ошибка при удалении карточки: ".concat(t.status))})).catch((function(t){return Promise.reject("Ошибка при удалении карточки: ".concat(t))}))).then((function(){P.remove()})).catch((function(t){V(t,"Ошибка при удалении карточки")})).finally((function(){i(g)}))})),h.addEventListener("click",(function(){U.value=b.textContent,B.value=S.textContent,d(T,J),a(E)})),T.addEventListener("submit",(function(e){var n;e.preventDefault(),F(!0,M),(n={name:U.value,about:B.value},fetch("".concat(t.baseURL,"/users/me"),{method:"PATCH",headers:{authorization:t.headers.authorization,"Content-Type":"application/json"},body:JSON.stringify(n)}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка ".concat(t.status))}))).then((function(t){b.textContent=t.name,S.textContent=t.about})).catch((function(t){V(t,"Не удалось обновить профиль")})).finally((function(){F(!1,M),i(E)}))})),R.addEventListener("submit",(function(e){var n;e.preventDefault(),F(!0,H),(n={name:w.value,link:D.value},fetch("".concat(t.baseURL,"/cards"),{method:"POST",headers:{authorization:t.headers.authorization,"Content-Type":"application/json"},body:JSON.stringify(n)}).then((function(t){return t.json()}))).then((function(t){var e=r(t,p,G,K,c);_.prepend(e),R.reset(),d(R,J)})).catch((function(t){V(t,"Не удалось добавить карточку")})).finally((function(){F(!1,H),i(C)}))})),O.addEventListener("submit",(function(e){var n;e.preventDefault(),F(!0,I),(n=N.value,fetch("".concat(t.baseURL,"/users/me/avatar"),{method:"PATCH",headers:{authorization:t.headers.authorization,"Content-Type":"application/json"},body:JSON.stringify({avatar:n})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка ".concat(t.status))}))).then((function(t){L.style.backgroundImage="url(".concat(t.avatar,")"),O.reset(),d(O,J)})).catch((function(t){V(t,"Не удалось обновить аватар")})).finally((function(){F(!1,I),i(j)}))})),v.addEventListener("click",(function(){d(R,J),R.reset(),a(C)})),L.addEventListener("click",(function(){d(O,J),O.reset(),a(j)})),y.forEach((function(t){t.addEventListener("click",(function(){i(t.closest(".popup"))}))})),k.forEach((function(t){t.addEventListener("click",(function(e){e.target===e.currentTarget&&i(t)}))})),fetch("".concat(t.baseURL,"/cards"),{headers:{authorization:t.headers.authorization,"content-type":"application/json"}}).then((function(t){return t.ok||console.log(t.status),t.json()})).then((function(t){t.forEach((function(t){_.append(r(t,p,G,K,c))}))})),fetch("".concat(t.baseURL,"/users/me"),{headers:{authorization:t.headers.authorization,"content-type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка ".concat(t.status))})).then((function(t){b.textContent=t.name,S.textContent=t.about,L.style.backgroundImage="url(".concat(t.avatar,")"),p=t._id})).catch((function(t){V(t,"Не удалось загрузить профиль пользователя")})),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){e.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);l(n,o,e),n.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?s(t,e,n):function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(t,e,e.validationMessage,n)}(t,r,e),l(n,o,e)}))}))}(e,t)}))}(J)})();